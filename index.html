<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>app-link by siyanhui</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>app-link</h1>
        <p></p>
        <p class="view"><a href="https://github.com/siyanhui/melink">View the Project on GitHub <small>siyanhui/melink</small></a></p>
        <ul>
          <li><a href="https://github.com/siyanhui/melink/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/siyanhui/melink/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/siyanhui/melink">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="app-接入指南" class="anchor" href="#app-%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97" aria-hidden="true"><span class="octicon octicon-link"></span></a>App 接入指南</h1>

<p>文档中, App表示客户端,Server表示服务器端</p>

<h2>
<a id="接入步骤" class="anchor" href="#%E6%8E%A5%E5%85%A5%E6%AD%A5%E9%AA%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>接入步骤</h2>

<ol>
<li>启动App<br>
</li>
<li>App本地判断是否已经在<code>Server</code>端注册过, 如果没有注册过,则<code>Server</code>返回一个<code>appid</code>和<code>appsecret</code>作为身份和加密串,如果无特殊说明<code>App</code>每次请求<code>Server</code>都必须带上这个<code>appid</code>作为身份标识,另外还必须传输<code>timestamp</code>时间戳参数作为动态签名用,每次请求<code>Server</code>都将带有<code>sign</code>签名参数,<code>Server</code>根据<code>sign</code>来判断此<code>App</code>请求是否合法。</li>
</ol>

<p><code>Sign</code>签名参数生成规则:<br>
将所传递参数的key根据字典排序,然后将<code>key</code>和<code>value</code>字符串想加起来,将最终的字符串<code>md5</code>哈希得到<code>sign</code>签名  </p>

<h2>
<a id="请求示例" class="anchor" href="#%E8%AF%B7%E6%B1%82%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>请求示例</h2>

<p>例如用户<code>post</code>登录接口,参数如下：</p>

<pre><code>mobile=13333333333&amp;password=123456&amp;appid=123456&amp;timestamp=123456
</code></pre>

<p>1.先根据字典将<code>key</code>排序,<code>appid,mobile,password,timestamp</code></p>

<p>2.拼接字符串</p>

<pre><code>string str =
"appid123456"+"mobile1333333333"+"password123456"+"timestamp123456"+appsecret
</code></pre>

<p>3.对生成的<code>str</code>进行<code>md5</code>哈希<code>string sign = md5(str)</code></p>

<p>4.将<code>sign</code>参数作为签名参数传给<code>Server</code>,<code>Server</code>获取到所有参数,将sign签名排除之后用同样的方法声称<code>sign</code>来验证。如果合法则继续操作流程,测试环境可暂时不加这个限制,但是功能要预留。</p>

<p>5.签名时的中文需要使用<code>utf-8</code>进行<code>urlencode</code>,<code>signature</code>验证签名生成方式修改为</p>

<pre><code>md5(appid+appsecret+timestamp) //这里注意把MD5值设置为大写
</code></pre>

<p>6.<code>http</code>接口如不特殊说明,都表示<code>App</code>向<code>Server</code>请求,如不特殊说明,请求都将带有<code>sign</code>,<code>appid</code>和<code>timestamp</code>。</p>

<p>6.1、如果获取失败,响应格式为：</p>

<div class="highlight highlight-json"><pre>    {
    <span class="pl-s1"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>:<span class="pl-s1"><span class="pl-pds">"</span>fail<span class="pl-pds">"</span></span>,
    <span class="pl-s1"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>:<span class="pl-c1">1001</span>,
    <span class="pl-s1"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>:<span class="pl-s1"><span class="pl-pds">"</span>数据库连接失败<span class="pl-pds">"</span></span>
    }</pre></div>

<p>6.2、如果获取成功,响应格式为：</p>

<div class="highlight highlight-json"><pre>    {
     <span class="pl-s1"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>:<span class="pl-s1"><span class="pl-pds">"</span>success<span class="pl-pds">"</span></span>,
     <span class="pl-s1"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>:<span class="pl-c1">200</span>,
     <span class="pl-s1"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>:<span class="pl-s1"><span class="pl-pds">"</span>{data}<span class="pl-pds">"</span></span> <span class="pl-ii">//不同接口返回的data不同</span>
    }</pre></div>

<h2>
<a id="特别说明" class="anchor" href="#%E7%89%B9%E5%88%AB%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>特别说明</h2>

<p>后续文档中的返回值都表示响应成功里的<code>result</code>属性值,如没有特殊说明,接口写到的参数都为必传,并且都需要<code>sign</code>签名和<code>appid</code>。
所有接口中传递的参数,请求<code>url</code>地址和返回值的<code>key</code>都约定为纯小写。</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/siyanhui">siyanhui</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-4316341-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>